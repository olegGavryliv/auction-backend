<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">


    <changeSet id="06" author="Havrilv">
        <createTable tableName="bid">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="price" type="DECIMAL">
            </column>
            <column name="time" type="TIMESTAMP">
            </column>
            <column name="bidder_id" type="bigint">
            </column>
            <column name="product_id" type="bigint">
            </column>
        </createTable>

    </changeSet>

    <changeSet id="06_1" author="Havrilv">
        <addForeignKeyConstraint baseColumnNames="bidder_id"
                                 baseTableName="bid"
                                 constraintName="fk_bid_user_id"
                                 referencedColumnNames="id"
                                 referencedTableName="user"/>

        <addForeignKeyConstraint baseColumnNames="product_id"
                                 baseTableName="bid"
                                 constraintName="fk_bid_product_id"
                                 referencedColumnNames="id"
                                 referencedTableName="product"/>

    </changeSet>


    <changeSet author="Havryliv" id="06_2">
        <addColumn tableName="product">
            <column name="expire_time" type="DATE"/>
        </addColumn>
        <update tableName="product">
            <column name="expire_time" value="2019-11-05" />
            <where>id = '1'</where>
        </update>

        <rollback>
            <dropColumn tableName="product" columnName="expire_time" />
        </rollback>
    </changeSet>

</databaseChangeLog>
